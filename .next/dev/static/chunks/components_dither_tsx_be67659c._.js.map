{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/Hossam/components/dither.tsx"],"sourcesContent":["/* eslint-disable react/no-unknown-property */\r\n'use client';\r\n\r\nimport { useRef, useEffect, forwardRef } from 'react';\r\nimport { Canvas, useFrame, useThree } from '@react-three/fiber';\r\nimport { EffectComposer, wrapEffect } from '@react-three/postprocessing';\r\nimport { Effect } from 'postprocessing';\r\nimport * as THREE from 'three';\r\n\r\nimport './dither.css';\r\nimport { alpha } from 'framer-motion';\r\n\r\nconst waveVertexShader = `\r\nprecision highp float;\r\nvarying vec2 vUv;\r\nvoid main() {\r\n  vUv = uv;\r\n  vec4 modelPosition = modelMatrix * vec4(position, 1.0);\r\n  vec4 viewPosition = viewMatrix * modelPosition;\r\n  gl_Position = projectionMatrix * viewPosition;\r\n}\r\n`;\r\n\r\nconst waveFragmentShader = `\r\nprecision highp float;\r\nuniform vec2 resolution;\r\nuniform float time;\r\nuniform float waveSpeed;\r\nuniform float waveFrequency;\r\nuniform float waveAmplitude;\r\nuniform vec3 waveColor;\r\nuniform vec2 mousePos;\r\nuniform int enableMouseInteraction;\r\nuniform float mouseRadius;\r\n\r\nvec4 mod289(vec4 x) { return x - floor(x * (1.0/289.0)) * 289.0; }\r\nvec4 permute(vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }\r\nvec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\r\nvec2 fade(vec2 t) { return t*t*t*(t*(t*6.0-15.0)+10.0); }\r\n\r\nfloat cnoise(vec2 P) {\r\n  vec4 Pi = floor(P.xyxy) + vec4(0.0,0.0,1.0,1.0);\r\n  vec4 Pf = fract(P.xyxy) - vec4(0.0,0.0,1.0,1.0);\r\n  Pi = mod289(Pi);\r\n  vec4 ix = Pi.xzxz;\r\n  vec4 iy = Pi.yyww;\r\n  vec4 fx = Pf.xzxz;\r\n  vec4 fy = Pf.yyww;\r\n  vec4 i = permute(permute(ix) + iy);\r\n  vec4 gx = fract(i * (1.0/41.0)) * 2.0 - 1.0;\r\n  vec4 gy = abs(gx) - 0.5;\r\n  vec4 tx = floor(gx + 0.5);\r\n  gx = gx - tx;\r\n  vec2 g00 = vec2(gx.x, gy.x);\r\n  vec2 g10 = vec2(gx.y, gy.y);\r\n  vec2 g01 = vec2(gx.z, gy.z);\r\n  vec2 g11 = vec2(gx.w, gy.w);\r\n  vec4 norm = taylorInvSqrt(vec4(dot(g00,g00), dot(g01,g01), dot(g10,g10), dot(g11,g11)));\r\n  g00 *= norm.x; g01 *= norm.y; g10 *= norm.z; g11 *= norm.w;\r\n  float n00 = dot(g00, vec2(fx.x, fy.x));\r\n  float n10 = dot(g10, vec2(fx.y, fy.y));\r\n  float n01 = dot(g01, vec2(fx.z, fy.z));\r\n  float n11 = dot(g11, vec2(fx.w, fy.w));\r\n  vec2 fade_xy = fade(Pf.xy);\r\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\r\n  return 2.3 * mix(n_x.x, n_x.y, fade_xy.y);\r\n}\r\n\r\nconst int OCTAVES = 4;\r\nfloat fbm(vec2 p) {\r\n  float value = 0.0;\r\n  float amp = 1.0;\r\n  float freq = waveFrequency;\r\n  for (int i = 0; i < OCTAVES; i++) {\r\n    value += amp * abs(cnoise(p));\r\n    p *= freq;\r\n    amp *= waveAmplitude;\r\n  }\r\n  return value;\r\n}\r\n\r\nfloat pattern(vec2 p) {\r\n  vec2 p2 = p - time * waveSpeed;\r\n  return fbm(p + fbm(p2)); \r\n}\r\n\r\nvoid main() {\r\n  vec2 uv = gl_FragCoord.xy / resolution.xy;\r\n  uv -= 0.5;\r\n  uv.x *= resolution.x / resolution.y;\r\n  float f = pattern(uv);\r\n  if (enableMouseInteraction == 1) {\r\n    vec2 mouseNDC = (mousePos / resolution - 0.5) * vec2(1.0, -1.0);\r\n    mouseNDC.x *= resolution.x / resolution.y;\r\n    float dist = length(uv - mouseNDC);\r\n    float effect = 1.0 - smoothstep(0.0, mouseRadius, dist);\r\n    f -= 0.5 * effect;\r\n  }\r\n  vec3 col = mix(vec3(0.0), waveColor, f);\r\n  gl_FragColor = vec4(col, 1.0);\r\n}\r\n`;\r\n\r\nconst ditherFragmentShader = `\r\nprecision highp float;\r\nuniform float colorNum;\r\nuniform float pixelSize;\r\nconst float bayerMatrix8x8[64] = float[64](\r\n  0.0/64.0, 48.0/64.0, 12.0/64.0, 60.0/64.0,  3.0/64.0, 51.0/64.0, 15.0/64.0, 63.0/64.0,\r\n  32.0/64.0,16.0/64.0, 44.0/64.0, 28.0/64.0, 35.0/64.0,19.0/64.0, 47.0/64.0, 31.0/64.0,\r\n  8.0/64.0, 56.0/64.0,  4.0/64.0, 52.0/64.0, 11.0/64.0,59.0/64.0,  7.0/64.0, 55.0/64.0,\r\n  40.0/64.0,24.0/64.0, 36.0/64.0, 20.0/64.0, 43.0/64.0,27.0/64.0, 39.0/64.0, 23.0/64.0,\r\n  2.0/64.0, 50.0/64.0, 14.0/64.0, 62.0/64.0,  1.0/64.0,49.0/64.0, 13.0/64.0, 61.0/64.0,\r\n  34.0/64.0,18.0/64.0, 46.0/64.0, 30.0/64.0, 33.0/64.0,17.0/64.0, 45.0/64.0, 29.0/64.0,\r\n  10.0/64.0,58.0/64.0,  6.0/64.0, 54.0/64.0,  9.0/64.0,57.0/64.0,  5.0/64.0, 53.0/64.0,\r\n  42.0/64.0,26.0/64.0, 38.0/64.0, 22.0/64.0, 41.0/64.0,25.0/64.0, 37.0/64.0, 21.0/64.0\r\n);\r\n\r\nvec3 dither(vec2 uv, vec3 color) {\r\n  vec2 scaledCoord = floor(uv * resolution / pixelSize);\r\n  int x = int(mod(scaledCoord.x, 8.0));\r\n  int y = int(mod(scaledCoord.y, 8.0));\r\n  float threshold = bayerMatrix8x8[y * 8 + x] - 0.25;\r\n  float step = 1.0 / (colorNum - 1.0);\r\n  color += threshold * step;\r\n  float bias = 0.2;\r\n  color = clamp(color - bias, 0.0, 1.0);\r\n  return floor(color * (colorNum - 1.0) + 0.5) / (colorNum - 1.0);\r\n}\r\n\r\nvoid mainImage(in vec4 inputColor, in vec2 uv, out vec4 outputColor) {\r\n  vec2 normalizedPixelSize = pixelSize / resolution;\r\n  vec2 uvPixel = normalizedPixelSize * floor(uv / normalizedPixelSize);\r\n  vec4 color = texture2D(inputBuffer, uvPixel);\r\n  color.rgb = dither(uv, color.rgb);\r\n  outputColor = color;\r\n}\r\n`;\r\n\r\nclass RetroEffectImpl extends Effect {\r\n  constructor() {\r\n    const uniforms = new Map([\r\n      ['colorNum', new THREE.Uniform(4.0)],\r\n      ['pixelSize', new THREE.Uniform(2.0)]\r\n    ]);\r\n    super('RetroEffect', ditherFragmentShader, { uniforms });\r\n    this.uniforms = uniforms;\r\n  }\r\n  set colorNum(v) {\r\n    this.uniforms.get('colorNum').value = v;\r\n  }\r\n  get colorNum() {\r\n    return this.uniforms.get('colorNum').value;\r\n  }\r\n  set pixelSize(v) {\r\n    this.uniforms.get('pixelSize').value = v;\r\n  }\r\n  get pixelSize() {\r\n    return this.uniforms.get('pixelSize').value;\r\n  }\r\n}\r\n\r\nconst WrappedRetro = wrapEffect(RetroEffectImpl);\r\n\r\nconst RetroEffect = forwardRef((props, ref) => {\r\n  const { colorNum, pixelSize } = props;\r\n  return <WrappedRetro ref={ref} colorNum={colorNum} pixelSize={pixelSize} />;\r\n});\r\nRetroEffect.displayName = 'RetroEffect';\r\n\r\nfunction DitheredWaves({\r\n  waveSpeed,\r\n  waveFrequency,\r\n  waveAmplitude,\r\n  waveColor,\r\n  colorNum,\r\n  pixelSize,\r\n  disableAnimation,\r\n  enableMouseInteraction,\r\n  mouseRadius\r\n}) {\r\n  const mesh = useRef(null);\r\n  const mouseRef = useRef(new THREE.Vector2());\r\n  const { viewport, size, gl } = useThree();\r\n\r\n  const waveUniformsRef = useRef({\r\n    time: new THREE.Uniform(0),\r\n    resolution: new THREE.Uniform(new THREE.Vector2(0, 0)),\r\n    waveSpeed: new THREE.Uniform(waveSpeed),\r\n    waveFrequency: new THREE.Uniform(waveFrequency),\r\n    waveAmplitude: new THREE.Uniform(waveAmplitude),\r\n    waveColor: new THREE.Uniform(new THREE.Color(...waveColor)),\r\n    mousePos: new THREE.Uniform(new THREE.Vector2(0, 0)),\r\n    enableMouseInteraction: new THREE.Uniform(enableMouseInteraction ? 1 : 0),\r\n    mouseRadius: new THREE.Uniform(mouseRadius)\r\n  });\r\n\r\n  useEffect(() => {\r\n    const dpr = gl.getPixelRatio();\r\n    const w = Math.floor(size.width * dpr),\r\n      h = Math.floor(size.height * dpr);\r\n    const res = waveUniformsRef.current.resolution.value;\r\n    if (res.x !== w || res.y !== h) {\r\n      res.set(w, h);\r\n    }\r\n  }, [size, gl]);\r\n\r\n  const prevColor = useRef([...waveColor]);\r\n  useFrame(({ clock }) => {\r\n    const u = waveUniformsRef.current;\r\n\r\n    if (!disableAnimation) {\r\n      u.time.value = clock.getElapsedTime();\r\n    }\r\n\r\n    if (u.waveSpeed.value !== waveSpeed) u.waveSpeed.value = waveSpeed;\r\n    if (u.waveFrequency.value !== waveFrequency) u.waveFrequency.value = waveFrequency;\r\n    if (u.waveAmplitude.value !== waveAmplitude) u.waveAmplitude.value = waveAmplitude;\r\n\r\n    if (!prevColor.current.every((v, i) => v === waveColor[i])) {\r\n      u.waveColor.value.set(...waveColor);\r\n      prevColor.current = [...waveColor];\r\n    }\r\n\r\n    u.enableMouseInteraction.value = enableMouseInteraction ? 1 : 0;\r\n    u.mouseRadius.value = mouseRadius;\r\n\r\n    if (enableMouseInteraction) {\r\n      u.mousePos.value.copy(mouseRef.current);\r\n    }\r\n  });\r\n\r\n  const handlePointerMove = e => {\r\n    if (!enableMouseInteraction) return;\r\n    const rect = gl.domElement.getBoundingClientRect();\r\n    const dpr = gl.getPixelRatio();\r\n    mouseRef.current.set((e.clientX - rect.left) * dpr, (e.clientY - rect.top) * dpr);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <mesh ref={mesh} scale={[viewport.width, viewport.height, 1]}>\r\n        <planeGeometry args={[1, 1]} />\r\n        <shaderMaterial\r\n          vertexShader={waveVertexShader}\r\n          fragmentShader={waveFragmentShader}\r\n          uniforms={waveUniformsRef.current}\r\n        />\r\n      </mesh>\r\n\r\n      <EffectComposer>\r\n        <RetroEffect colorNum={colorNum} pixelSize={pixelSize} />\r\n      </EffectComposer>\r\n\r\n      <mesh\r\n        onPointerMove={handlePointerMove}\r\n        position={[0, 0, 0.01]}\r\n        scale={[viewport.width, viewport.height, 1]}\r\n        visible={false}\r\n      >\r\n        <planeGeometry args={[1, 1]} />\r\n        <meshBasicMaterial transparent opacity={0} />\r\n      </mesh>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default function Dither({\r\n  waveSpeed = 0.05,\r\n  waveFrequency = 3,\r\n  waveAmplitude = 0.3,\r\n  waveColor = [0.5, 0.5, 0.5],\r\n  colorNum = 4,\r\n  pixelSize = 2,\r\n  disableAnimation = false,\r\n  enableMouseInteraction = true,\r\n  mouseRadius = 1\r\n}) {\r\n  return (\r\n    <Canvas\r\n      className=\"dither-container\"\r\n      camera={{ position: [0, 0, 6] }}\r\n      dpr={1}\r\n      gl={{ alpha: true, antialias: true }}\r\n    >\r\n      <DitheredWaves\r\n        waveSpeed={waveSpeed}\r\n        waveFrequency={waveFrequency}\r\n        waveAmplitude={waveAmplitude}\r\n        waveColor={waveColor}\r\n        colorNum={colorNum}\r\n        pixelSize={pixelSize}\r\n        disableAnimation={disableAnimation}\r\n        enableMouseInteraction={enableMouseInteraction}\r\n        mouseRadius={mouseRadius}\r\n      />\r\n    </Canvas>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}